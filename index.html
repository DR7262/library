<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Library</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="header">
        <h1 class="logo">BookLog</h1>
        <button class="btn" id="newBook">New</button>
    </div>
    <div id="books">
    </div>
    <div class="overlay" id = "overlay">
        <form class = "prompt">
            <p class="message">Add new book</p>
            <input type="text" required name = "book" id = "newBookTitle" placeholder="Book">
            <input type="text" required name = "author" id = "newBookAuthor" placeholder="Author">
            <input type="number" required name = "year" id = "newBookYear" placeholder="Year">
            <input type="number" required name = "pages" id = "newBookPages" placeholder="Pages">
                <label for="read" class="readStatus"> Have I read it?
                    <input type="checkbox" name = "read" id = "newBookReadStatus" placeholder="Read?">
                </label>
            <button type="submit" class = "btn" id = "newBookConfirm">Confirm</button>
        </form>
    </div>

    <script>
        let myLibrary = [];
        const books = document.getElementById('books');
        const newBook = document.getElementById('newBook');
        const overlay = document.getElementById('overlay');
        const newBookConfirm = document.getElementById('newBookConfirm');

        const newBookTitle = document.getElementById('newBookTitle');
        const newBookAuthor = document.getElementById('newBookAuthor');
        const newBookYear = document.getElementById('newBookYear');
        const newBookPages = document.getElementById('newBookPages');
        const newBookReadStatus = document.getElementById('newBookReadStatus');

        const newBookData = [newBookTitle, newBookAuthor, newBookPages, newBookYear, newBookReadStatus]

        newBook.addEventListener("click", () => {
            overlay.classList.toggle("active");
        });

        overlay.addEventListener("click", (e) => {
            if (e.target === overlay) {
                overlay.classList.toggle("active");
            }
        });

        newBookConfirm.addEventListener("click", (e) => {
            if (checkFormValidity() === true) {
                let newBook = new Book(newBookTitle.value, newBookAuthor.value, newBookPages.value, newBookYear.value, true)
                myLibrary.push(newBook);
                overlay.classList.toggle("active");
                displayBookCards(myLibrary);
                clearNewBookForm();
                event.preventDefault()
            }
        });

        function Book(title, author, pages, year, read) {
            this.title = title;
            this.author = author;
            this.pages = pages;
            this.year = year;
            this.read = read;
        };

        let test1 = new Book('Lord of the Rings', 'J.R. Tolkien',100, 2021, true);
        let test2 = new Book('Twilight', 'Stephenie Meyer',104, 1996, true);

        myLibrary.push(test1);
        myLibrary.push(test2);

        displayBookCards(myLibrary);

        function createBookCard(book) {
            let card = document.createElement('div');
            card.classList.add('book');
            
            for (prop in book) {
                let info = document.createElement('p');
                info.classList.add('info');
                info.classList.add(prop);
                info.textContent = book[prop];

                card.appendChild(info);
            }

            return card;
        };

        function displayBookCards(currentLib) {
            books.innerHTML = ''
            for (book in currentLib) {
                currentCard = createBookCard(currentLib[book]);
                books.appendChild(currentCard);
            }
        }

        function clearNewBookForm() {
            for (let i = 0; i < newBookData.length; i++) {
                newBookData[i].value = '';
            }
        }

        function checkFormValidity() {
            for (let i = 0; i < newBookData.length - 1; i++) {
                if (newBookData[i].validity.valid == false) return false
            }
            return true;
        }
    </script>
</body>
</html>